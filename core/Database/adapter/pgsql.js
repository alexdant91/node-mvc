"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));require("dotenv").config();var _require=require("../../../core/Database/config/pgsql"),client=_require.client,PgSQLAdapter=function a(b){var c=this;(0,_classCallCheck2["default"])(this,a),(0,_defineProperty2["default"])(this,"getUserToken",function(a){return!!a.headers.authorization&&a.headers.authorization.split("Bearer ")[1]}),(0,_defineProperty2["default"])(this,"findById",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e,f,g;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d="id = $1",e=[b],!b){a.next=17;break}return a.prev=3,a.next=6,c.Client.query("SELECT * FROM ".concat(c.modelName," WHERE ").concat(d),e);case 6:return f=a.sent,g=f.rows,a.abrupt("return",g[0]);case 11:return a.prev=11,a.t0=a["catch"](3),debug.danger(a.t0.message),a.abrupt("return",{error:a.t0.message});case 15:a.next=19;break;case 17:return debug.danger("Missing required field `id` on `findOne` model. You can provide it on request body or query."),a.abrupt("return",{error:"Missing required field `id` on `findOne` model. You can provide it on request body or query."});case 19:case"end":return a.stop();}},a,null,[[3,11]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"findOne",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<h.length&&void 0!==h[0]?h[0]:{},d=Object.keys(b).map(function(a,b){return"".concat(a," = $").concat(b+1)}).join(" AND "),e=Object.keys(b).map(function(a){return b[a]}),a.prev=3,a.next=6,c.Client.query("SELECT * FROM ".concat(c.modelName," WHERE ").concat(d),e);case 6:return f=a.sent,g=f.rows,a.abrupt("return",g[0]);case 11:return a.prev=11,a.t0=a["catch"](3),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 15:case"end":return a.stop();}},a,null,[[3,11]])}))),(0,_defineProperty2["default"])(this,"find",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<h.length&&void 0!==h[0]?h[0]:{},d=Object.keys(b).map(function(a,b){return"".concat(a," = $").concat(b+1)}).join(" AND "),e=Object.keys(b).map(function(a){return b[a]}),a.prev=3,a.next=6,c.Client.query("SELECT * FROM ".concat(c.modelName," WHERE ").concat(d),e);case 6:return f=a.sent,g=f.rows,a.abrupt("return",g);case 11:return a.prev=11,a.t0=a["catch"](3),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 15:case"end":return a.stop();}},a,null,[[3,11]])}))),(0,_defineProperty2["default"])(this,"findAll",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,c.Client.query("SELECT * FROM ".concat(c.modelName));case 3:return b=a.sent,d=b.rows,a.abrupt("return",d);case 8:return a.prev=8,a.t0=a["catch"](0),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 12:case"end":return a.stop();}},a,null,[[0,8]])}))),(0,_defineProperty2["default"])(this,"paginate",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h,i=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<i.length&&void 0!==i[0]?i[0]:{},d=1<i.length&&void 0!==i[1]?i[1]:{page:1,limit:12},d.page||(d.page=1),d.limit||(d.limit=12),e=Object.keys(b).map(function(a,b){return"".concat(a," = $").concat(b+1)}).join(" AND "),f=Object.keys(b).map(function(a){return b[a]}),a.prev=6,a.next=9,c.Client.query("SELECT * FROM ".concat(c.modelName," WHERE (").concat(e,") LIMIT ").concat(d.limit," OFFSET ").concat((d.page-1)*d.limit),f);case 9:return g=a.sent,h=g.rows,a.abrupt("return",{results:h,page:d.page,limit:d.limit});case 14:return a.prev=14,a.t0=a["catch"](6),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 18:case"end":return a.stop();}},a,null,[[6,14]])}))),(0,_defineProperty2["default"])(this,"paginateAll",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<f.length&&void 0!==f[0]?f[0]:{page:1,limit:12},b.page||(b.page=1),b.limit||(b.limit=12),a.prev=3,a.next=6,c.Client.query("SELECT * FROM ".concat(c.modelName," LIMIT ").concat(b.limit," OFFSET ").concat((b.page-1)*b.limit));case 6:return d=a.sent,e=d.rows,a.abrupt("return",{results:e,page:b.page,limit:b.limit});case 11:return a.prev=11,a.t0=a["catch"](3),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 15:case"end":return a.stop();}},a,null,[[3,11]])}))),(0,_defineProperty2["default"])(this,"create",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h,i=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<i.length&&void 0!==i[0]?i[0]:{},d=Object.keys(b).join(", "),e=Object.keys(b).map(function(a,b){return"$".concat(b+1)}).join(", "),f=Object.keys(b).map(function(a){return b[a]}),a.prev=4,a.next=7,c.Client.query("INSERT INTO ".concat(c.modelName," (").concat(d,") VALUES (").concat(e,")"),f);case 7:return g=a.sent,h=g.rows,a.abrupt("return",h[0]);case 12:return a.prev=12,a.t0=a["catch"](4),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 16:case"end":return a.stop();}},a,null,[[4,12]])}))),(0,_defineProperty2["default"])(this,"update",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h,i,j,k,l,m=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<m.length&&void 0!==m[0]?m[0]:{},d=1<m.length&&void 0!==m[1]?m[1]:{},e=Object.keys(d).length,f=Object.keys(d).map(function(a,b){return"".concat(a," = ($").concat(b+1,")")}).join(", "),g=Object.keys(b).map(function(a,b){return"".concat(a," = ($").concat(b+1+e,")")}).join(" AND "),h=Object.keys(d).map(function(a){return d[a]}),i=Object.keys(b).map(function(a){return b[a]}),j=h.concat(i),a.prev=8,a.next=11,c.Client.query("UPDATE ".concat(c.modelName," SET ").concat(f," WHERE ").concat(g),j);case 11:return k=a.sent,l=k.rows,a.abrupt("return",l);case 16:return a.prev=16,a.t0=a["catch"](8),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 20:case"end":return a.stop();}},a,null,[[8,16]])}))),(0,_defineProperty2["default"])(this,"updateById",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e,f,g,h,i,j,k,l,m=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=1<m.length&&void 0!==m[1]?m[1]:{},e=Object.keys(d).length,f=Object.keys(d).map(function(a,b){return"".concat(a," = ($").concat(b+1,")")}).join(", "),g="id = ($".concat(e+1,")"),h=Object.keys(d).map(function(a){return d[a]}),i=[b],j=h.concat(i),!b){a.next=22;break}return a.prev=8,a.next=11,c.Client.query("UPDATE ".concat(c.modelName," SET ").concat(f," WHERE ").concat(g),j);case 11:return k=a.sent,l=k.rows,a.abrupt("return",l[0]);case 16:return a.prev=16,a.t0=a["catch"](8),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 20:a.next=24;break;case 22:return debug.danger("Missing required field `id` on `findOne` model."),a.abrupt("return",{error:"Missing required field `id` on `findOne` model."});case 24:case"end":return a.stop();}},a,null,[[8,16]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"delete",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=Object.keys(b).map(function(a,b){return"".concat(a," = ($").concat(b+1,")")}).join(" AND "),e=Object.keys(b).map(function(a){return b[a]}),a.prev=2,a.next=5,c.Client.query("DELETE FROM ".concat(c.modelName," WHERE ").concat(d),e);case 5:return a.abrupt("return",{error:null,message:"".concat(c.modelName," successfully deleted.")});case 8:return a.prev=8,a.t0=a["catch"](2),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 12:case"end":return a.stop();}},a,null,[[2,8]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"deleteById",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d="id = $1",e=[b],!b){a.next=15;break}return a.prev=3,a.next=6,c.Client.query("DELETE FROM ".concat(c.modelName," WHERE ").concat(d),e);case 6:return a.abrupt("return",{error:null,message:"".concat(c.modelName," \"").concat(b,"\" successfully deleted.")});case 9:return a.prev=9,a.t0=a["catch"](3),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 13:a.next=17;break;case 15:return debug.danger("Missing required field `id` on `findOne` model."),a.abrupt("return",{error:"Missing required field `id` on `findOne` model."});case 17:case"end":return a.stop();}},a,null,[[3,9]])}));return function(){return a.apply(this,arguments)}}()),this.modelName=b,this.Model=b?require("../../../app/Models/".concat(this.modelName)):{hash:[],exclude:[]},this.fieldsToHash=this.Model.hash,this.fieldsToExclude=this.Model.exclude,this.Client=client};module.exports=PgSQLAdapter;