"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}require("dotenv").config();var _require=require("../../../core/Database/config/mongo"),models=_require.models,MongoAdapter=function a(b){var c=this;(0,_classCallCheck2["default"])(this,a),(0,_defineProperty2["default"])(this,"getUserToken",function(a){return!!a.headers.authorization&&a.headers.authorization.split("Bearer ")[1]}),(0,_defineProperty2["default"])(this,"findById",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=1<h.length&&void 0!==h[1]?h[1]:null,e=c.Models,f=e[c.modelName],g={_id:b},!b){a.next=17;break}return a.prev=5,a.next=8,f.findOne(g,d,{lean:!0});case 8:return a.abrupt("return",a.sent);case 11:return a.prev=11,a.t0=a["catch"](5),debug.danger(a.t0.message),a.abrupt("return",{error:a.t0.message});case 15:a.next=19;break;case 17:return debug.danger("Missing required field `id` on `findOne` model. You can provide it on request body or query."),a.abrupt("return",{error:"Missing required field `id` on `findOne` model. You can provide it on request body or query."});case 19:case"end":return a.stop();}},a,null,[[5,11]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"findOne",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<g.length&&void 0!==g[0]?g[0]:{},d=1<g.length&&void 0!==g[1]?g[1]:null,e=c.Models,f=e[c.modelName],a.prev=4,a.next=7,f.findOne(b,d,{lean:!0});case 7:return a.abrupt("return",a.sent);case 10:return a.prev=10,a.t0=a["catch"](4),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 14:case"end":return a.stop();}},a,null,[[4,10]])}))),(0,_defineProperty2["default"])(this,"find",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<g.length&&void 0!==g[0]?g[0]:{},d=1<g.length&&void 0!==g[1]?g[1]:null,e=c.Models,f=e[c.modelName],a.prev=4,a.next=7,f.find(b,d,{lean:!0});case 7:return a.abrupt("return",a.sent);case 10:return a.prev=10,a.t0=a["catch"](4),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 14:case"end":return a.stop();}},a,null,[[4,10]])}))),(0,_defineProperty2["default"])(this,"findAll",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<g.length&&void 0!==g[0]?g[0]:null,d=c.Models,e=d[c.modelName],f={},a.prev=4,a.next=7,e.find(f,b,{lean:!0});case 7:return a.abrupt("return",a.sent);case 10:return a.prev=10,a.t0=a["catch"](4),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 14:case"end":return a.stop();}},a,null,[[4,10]])}))),(0,_defineProperty2["default"])(this,"paginate",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<h.length&&void 0!==h[0]?h[0]:{},d=1<h.length&&void 0!==h[1]?h[1]:{page:1,limit:12},e=2<h.length&&void 0!==h[2]?h[2]:null,f=c.Models,g=f[c.modelName],d.page||(d.page=1),d.limit||(d.limit=12),a.prev=7,a.next=10,g.paginate(b,_objectSpread(_objectSpread({select:e},d),{},{lean:!0}));case 10:return a.abrupt("return",a.sent);case 13:return a.prev=13,a.t0=a["catch"](7),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 17:case"end":return a.stop();}},a,null,[[7,13]])}))),(0,_defineProperty2["default"])(this,"paginateAll",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<g.length&&void 0!==g[0]?g[0]:{page:1,limit:12},d=1<g.length&&void 0!==g[1]?g[1]:null,e=c.Models,f=e[c.modelName],b.page||(b.page=1),b.limit||(b.limit=12),a.prev=6,a.next=9,f.paginate({},_objectSpread(_objectSpread({select:d},b),{},{lean:!0}));case 9:return a.abrupt("return",a.sent);case 12:return a.prev=12,a.t0=a["catch"](6),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 16:case"end":return a.stop();}},a,null,[[6,12]])}))),(0,_defineProperty2["default"])(this,"create",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<h.length&&void 0!==h[0]?h[0]:{},d=1<h.length&&void 0!==h[1]?h[1]:null,c.fieldsToHash.forEach(function(a){b.hasOwnProperty(a)&&(b[a]=bcrypt.hashSync(b[a],12))}),e=c.Models,f=e[c.modelName],a.prev=5,a.next=8,new f(b).save();case 8:return g=a.sent,d.forEach(function(a){return delete g[a]}),a.abrupt("return",_objectSpread({},g));case 13:return a.prev=13,a.t0=a["catch"](5),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 17:case"end":return a.stop();}},a,null,[[5,13]])}))),(0,_defineProperty2["default"])(this,"update",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<h.length&&void 0!==h[0]?h[0]:{},d=1<h.length&&void 0!==h[1]?h[1]:{},c.fieldsToHash.forEach(function(a){d.hasOwnProperty(a)&&(d[a]=bcrypt.hashSync(d[a],12))}),e=c.Models,f=e[c.modelName],a.prev=5,g=0<c.fieldsToExclude.length?"-"+c.fieldsToExclude.join(" -"):null,a.next=9,f.updateOne(b,fields,{lean:!0});case 9:return a.next=11,f.findOne(b,g,{lean:!0});case 11:return a.abrupt("return",a.sent);case 14:return a.prev=14,a.t0=a["catch"](5),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 18:case"end":return a.stop();}},a,null,[[5,14]])}))),(0,_defineProperty2["default"])(this,"updateById",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=1<h.length&&void 0!==h[1]?h[1]:{},c.fieldsToHash.forEach(function(a){d.hasOwnProperty(a)&&(d[a]=bcrypt.hashSync(d[a],12))}),e=c.Models,f=e[c.modelName],!b){a.next=20;break}return a.prev=5,g=0<c.fieldsToExclude.length?"-"+c.fieldsToExclude.join(" -"):null,a.next=9,f.updateOne({_id:b},fields,{lean:!0});case 9:return a.next=11,f.findOne({_id:b},g,{lean:!0});case 11:return a.abrupt("return",a.sent);case 14:return a.prev=14,a.t0=a["catch"](5),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 18:a.next=22;break;case 20:return debug.danger("Missing required field `id` on `findOne` model."),a.abrupt("return",{error:"Missing required field `id` on `findOne` model."});case 22:case"end":return a.stop();}},a,null,[[5,14]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"updateMany",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,d,e,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=0<h.length&&void 0!==h[0]?h[0]:{},d=1<h.length&&void 0!==h[1]?h[1]:{},c.fieldsToHash.forEach(function(a){d.hasOwnProperty(a)&&(d[a]=bcrypt.hashSync(d[a],12))}),e=c.Models,f=e[c.modelName],a.prev=5,g=0<c.fieldsToExclude.length?"-"+c.fieldsToExclude.join(" -"):null,a.next=9,f.updateMany(b,fields,{lean:!0});case 9:return a.next=11,f.findOne(b,g,{lean:!0});case 11:return a.abrupt("return",a.sent);case 14:return a.prev=14,a.t0=a["catch"](5),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 18:case"end":return a.stop();}},a,null,[[5,14]])}))),(0,_defineProperty2["default"])(this,"delete",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c.Models,e=d[c.modelName],a.prev=2,a.next=5,e.deleteOne(b);case 5:return a.abrupt("return",{error:null,message:"".concat(c.modelName," successfully deleted.")});case 8:return a.prev=8,a.t0=a["catch"](2),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 12:case"end":return a.stop();}},a,null,[[2,8]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"deleteById",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=c.Models,e=d[c.modelName],!b){a.next=15;break}return a.prev=3,a.next=6,e.deleteOne({_id:b});case 6:return a.abrupt("return",{error:null,message:"".concat(c.modelName," successfully deleted.")});case 9:return a.prev=9,a.t0=a["catch"](3),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 13:a.next=17;break;case 15:return debug.danger("Missing required field `id` on `findOne` model."),a.abrupt("return",{error:"Missing required field `id` on `findOne` model."});case 17:case"end":return a.stop();}},a,null,[[3,9]])}));return function(){return a.apply(this,arguments)}}()),(0,_defineProperty2["default"])(this,"deleteMany",/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c.Models,e=d[c.modelName],a.prev=2,a.next=5,e.deleteMany(b);case 5:return a.abrupt("return",{error:null,message:"".concat(c.modelName," successfully deleted.")});case 8:return a.prev=8,a.t0=a["catch"](2),debug.danger(a.t0.message),a.abrupt("return",{error:"Internal Server Error."});case 12:case"end":return a.stop();}},a,null,[[2,8]])}));return function(){return a.apply(this,arguments)}}()),this.modelName=b,this.Model=b?require("../../../app/Models/".concat(this.modelName)):{hash:[],exclude:[]},this.fieldsToHash=this.Model.hash,this.fieldsToExclude=this.Model.exclude,this.Models=a.get("models")};(0,_defineProperty2["default"])(MongoAdapter,"labels",{models:models}),(0,_defineProperty2["default"])(MongoAdapter,"get",function(a){return MongoAdapter.labels[a]}),module.exports=MongoAdapter;